# ğŸš¨ ç´§æ€¥ä¿®å¤æ¸…å• - æ”¯ä»˜ç¯å¢ƒå’Œè´­ä¹°å†å²é—®é¢˜

## é—®é¢˜è¯Šæ–­ç»“æœ

### é—®é¢˜1: è´­ä¹°å†å²APIå¤±è´¥ âœ… å·²ä¿®å¤
**åŸå› **: `src/app/api/user/purchases/route.ts` è®¾ç½®äº† `export const runtime = "edge"` ä½†ä½¿ç”¨äº†Prismaï¼ŒEdge Runtimeä¸æ”¯æŒPrismaã€‚

**ä¿®å¤**: å·²ç§»é™¤ `export const runtime = "edge"` é…ç½®ã€‚

### é—®é¢˜2: ä»åœ¨ä½¿ç”¨æµ‹è¯•ç¯å¢ƒ âŒ éœ€è¦ç«‹å³ä¿®å¤
**åŸå› **: Cloudflare Pagesç¯å¢ƒå˜é‡é…ç½®ä¸æ­£ç¡®ï¼Œå¯¼è‡´ç¯å¢ƒåˆ¤æ–­å¤±æ•ˆã€‚

## ğŸ”§ ç«‹å³ä¿®å¤æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ›´æ–°Cloudflare Pagesç¯å¢ƒå˜é‡

ç™»å½•Cloudflare Pagesæ§åˆ¶å°ï¼Œè¿›å…¥ `cuttingasmr.org` é¡¹ç›®è®¾ç½®ï¼Œåœ¨ **Environment Variables** ä¸­è®¾ç½®ï¼š

#### ç”Ÿäº§ç¯å¢ƒå˜é‡ (Production)
```bash
NODE_ENV=production
CREEM_TEST_MODE=false
NEXT_PUBLIC_APP_URL=https://cuttingasmr.org

# æ•°æ®åº“
DATABASE_URL=postgresql://postgres:wGgVnAtvDEZxDmyZfMuJJLqSmteroInW@gondola.proxy.rlwy.net:10910/railway

# Clerkè®¤è¯
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_Y2xlcmsuY3V0dGluZ2FzbXIub3JnJA
CLERK_SECRET_KEY=sk_live_xxxï¼ˆä»ç°æœ‰é…ç½®å¤åˆ¶ï¼‰

# Creemæ”¯ä»˜
CREEM_API_KEY=creem_4bO7LLLWie17BD2i7qTNNA
CREEM_WEBHOOK_SECRET=whsec_6jovyxtbgdcdNEMdH0nspT

# VEO API
VEO_API_KEY=ï¼ˆä»ç°æœ‰é…ç½®å¤åˆ¶ï¼‰
VEO_API_BASE_URL=https://api.veo.dev
```

#### é¢„è§ˆç¯å¢ƒå˜é‡ (Preview) - å¯é€‰
```bash
NODE_ENV=development
CREEM_TEST_MODE=true
NEXT_PUBLIC_APP_URL=https://preview.cuttingasmr.org
# å…¶ä»–å˜é‡ä¸ç”Ÿäº§ç¯å¢ƒç›¸åŒ
```

### ç¬¬äºŒæ­¥ï¼šéªŒè¯ä¿®å¤æ•ˆæœ

#### 1. é‡æ–°éƒ¨ç½²åº”ç”¨
åœ¨Cloudflare Pagesæ§åˆ¶å°ä¸­è§¦å‘é‡æ–°éƒ¨ç½²ï¼Œæˆ–æ¨é€ä»£ç è§¦å‘è‡ªåŠ¨éƒ¨ç½²ã€‚

#### 2. æ£€æŸ¥ç¯å¢ƒé…ç½®
è®¿é—®ï¼š`https://cuttingasmr.org/api/check-creem-config`

**é¢„æœŸå“åº”**ï¼š
```json
{
  "environment": {
    "isTestMode": false,
    "NODE_ENV": "production",
    "CREEM_TEST_MODE": "false"
  },
  "productIds": {
    "current": {
      "starter": "prod_7jHfoQZh5FuYUbIJgIM9ZQ",
      "standard": "prod_7E4i1f1bV8CPMYc7gRx67l", 
      "premium": "prod_6mI2w4gJN4FfZ6FuOFzfcr"
    }
  },
  "paymentUrls": {
    "starter": "https://www.creem.io/payment/prod_7jHfoQZh5FuYUbIJgIM9ZQ"
  },
  "recommendation": "âœ… å½“å‰ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®"
}
```

#### 3. æµ‹è¯•è´­ä¹°å†å²API
è®¿é—®ï¼š`https://cuttingasmr.org/api/user/purchases`

**é¢„æœŸå“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "purchases": [...],
    "totalPurchases": 2,
    "totalSpent": 39.9,
    "totalCreditsEarned": 470
  }
}
```

#### 4. éªŒè¯æ”¯ä»˜é“¾æ¥
è®¿é—®ï¼š`https://cuttingasmr.org/pricing`

**æ£€æŸ¥è¦ç‚¹**ï¼š
- æ”¯ä»˜æŒ‰é’®é“¾æ¥åº”è¯¥æ˜¯ `https://www.creem.io/payment/prod_7xxx`
- **ä¸åº”è¯¥**åŒ…å« `/test/` è·¯å¾„
- ç‚¹å‡»æ”¯ä»˜å**ä¸åº”è¯¥**æ¥å—æµ‹è¯•å¡å· `4242 4242 4242 4242`

#### 5. æµ‹è¯•æ”¯ä»˜æˆåŠŸé¡µé¢
è®¿é—®ï¼š`https://cuttingasmr.org/payment/success?product_id=prod_7jHfoQZh5FuYUbIJgIM9ZQ&order_id=test_order&customer_id=test_customer`

**æ£€æŸ¥è¦ç‚¹**ï¼š
- é¡µé¢æ­£å¸¸åŠ è½½ï¼ˆæ— 502é”™è¯¯ï¼‰
- æ— çº¢è‰²é”™è¯¯æç¤º
- æ— é»„è‰²ç¯å¢ƒè­¦å‘Š
- ç§¯åˆ†ä¿¡æ¯æ­£å¸¸æ˜¾ç¤º

## ğŸ” éªŒè¯å®Œæˆæ ‡å‡†

æ‰€æœ‰ä»¥ä¸‹æ£€æŸ¥éƒ½é€šè¿‡æ‰ç®—ä¿®å¤å®Œæˆï¼š

- [ ] `/api/check-creem-config` è¿”å› `isTestMode: false`
- [ ] `/api/user/purchases` è¿”å›è´­ä¹°å†å²ï¼ˆæ— 500é”™è¯¯ï¼‰
- [ ] æ”¯ä»˜é“¾æ¥ä¸åŒ…å« `/test/` è·¯å¾„
- [ ] æ”¯ä»˜é¡µé¢æ‹’ç»æµ‹è¯•å¡å· `4242 4242 4242 4242`
- [ ] æ”¯ä»˜æˆåŠŸé¡µé¢æ— 502é”™è¯¯
- [ ] ä¸ªäººä¸­å¿ƒè´­ä¹°å†å²æ­£å¸¸æ˜¾ç¤º

## ğŸš¨ å¦‚æœä¿®å¤åä»æœ‰é—®é¢˜

### æƒ…å†µ1ï¼šç¯å¢ƒå˜é‡è®¾ç½®åä»æ˜¾ç¤ºæµ‹è¯•æ¨¡å¼
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ¸…é™¤Cloudflare Pagesç¼“å­˜
2. è§¦å‘å®Œæ•´é‡æ–°éƒ¨ç½²ï¼ˆä¸æ˜¯å¢é‡éƒ¨ç½²ï¼‰
3. ç­‰å¾…5-10åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ

### æƒ…å†µ2ï¼šè´­ä¹°å†å²ä»ç„¶500é”™è¯¯
**å¯èƒ½åŸå› **ï¼š
- æ•°æ®åº“è¿æ¥é—®é¢˜
- Prismaå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥
- è®¤è¯é—®é¢˜

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. è®¿é—® `/api/health` æ£€æŸ¥åŸºç¡€æœåŠ¡çŠ¶æ€
2. è®¿é—® `/api/credits` æ£€æŸ¥æ•°æ®åº“è¿æ¥
3. æ£€æŸ¥Cloudflare Pagesæ„å»ºæ—¥å¿—

### æƒ…å†µ3ï¼šæ”¯ä»˜ä»æ¥å—æµ‹è¯•å¡å·
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ç¼“å­˜ (Ctrl+F5)
2. æ£€æŸ¥ `NEXT_PUBLIC_APP_URL` æ˜¯å¦æ­£ç¡®è®¾ç½®
3. ç¡®è®¤ `CREEM_TEST_MODE=false`

## ğŸ“ éªŒè¯å‘½ä»¤

æœ¬åœ°éªŒè¯ç¯å¢ƒé…ç½®ï¼š
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦å…ˆè®¾ç½®æœ¬åœ°ç¯å¢ƒå˜é‡ï¼‰
node scripts/debug-environment.js

# æµ‹è¯•APIç«¯ç‚¹
npm run test:endpoints

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
npm run test:db
```

ç”Ÿäº§ç¯å¢ƒéªŒè¯ï¼š
```bash
# æ£€æŸ¥é…ç½®çŠ¶æ€
curl https://cuttingasmr.org/api/check-creem-config

# æ£€æŸ¥è´­ä¹°å†å²
curl https://cuttingasmr.org/api/user/purchases

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl https://cuttingasmr.org/api/health
```

## ğŸ¯ ä¿®å¤å®Œæˆåçš„æ•ˆæœ

1. **æ”¯ä»˜ç¯å¢ƒ**ï¼šä½¿ç”¨çœŸå®çš„Creemç”Ÿäº§ç¯å¢ƒï¼Œæ‹’ç»æµ‹è¯•å¡å·
2. **è´­ä¹°å†å²**ï¼šä¸ªäººä¸­å¿ƒæ­£å¸¸æ˜¾ç¤ºè´­ä¹°è®°å½•å’Œç§¯åˆ†åŒæ­¥çŠ¶æ€
3. **æ•°æ®åŒæ­¥**ï¼šæ”¯ä»˜æˆåŠŸåç§¯åˆ†è‡ªåŠ¨åŒæ­¥åˆ°ç”¨æˆ·è´¦æˆ·
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ£€æµ‹å’Œç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯

---

**é‡è¦æé†’**ï¼šä¿®å¤å®Œæˆåï¼Œè¯·ç«‹å³æµ‹è¯•ä¸€æ¬¡å°é¢çœŸå®æ”¯ä»˜ï¼ˆ$9.9ï¼‰ï¼Œç¡®ä¿æ•´ä¸ªæ”¯ä»˜æµç¨‹æ­£å¸¸å·¥ä½œã€‚ 