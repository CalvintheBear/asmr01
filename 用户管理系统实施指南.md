# ASMRè§†é¢‘ç”Ÿæˆåº”ç”¨ - ç”¨æˆ·ç®¡ç†ç³»ç»Ÿå®æ–½æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºæ‚¨ç°æœ‰çš„ASMRè§†é¢‘ç”Ÿæˆåº”ç”¨ï¼Œæˆ‘å·²ä¸ºæ‚¨è®¾è®¡äº†å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ–¹æ¡ˆã€‚è¯¥ç³»ç»Ÿé‡‡ç”¨**è½»é‡åŒ– + æ¸è¿›å¼**çš„æ¶æ„ï¼Œæ—¢ä¿æŒäº†ç°æœ‰åŠŸèƒ½çš„å®Œæ•´æ€§ï¼Œåˆä¸ºæœªæ¥æ‰©å±•ç•™ä¸‹äº†ç©ºé—´ã€‚

## ğŸ“‹ å·²å®Œæˆçš„åŸºç¡€æ¶æ„

### âœ… æ ¸å¿ƒæ–‡ä»¶å·²åˆ›å»º
- `ğŸ“„ prisma/schema.prisma` - æ•°æ®åº“æ¨¡å¼å®šä¹‰
- `ğŸ“„ src/lib/prisma.ts` - Prismaå®¢æˆ·ç«¯
- `ğŸ“„ src/lib/auth.ts` - NextAuthé…ç½®
- `ğŸ“„ src/app/api/auth/[...nextauth]/route.ts` - è®¤è¯APIè·¯ç”±
- `ğŸ“„ src/app/api/auth/register/route.ts` - ç”¨æˆ·æ³¨å†ŒAPI
- `ğŸ“„ src/app/api/user/credits/route.ts` - ç§¯åˆ†ç®¡ç†API
- `ğŸ“„ src/components/SessionProvider.tsx` - Sessionæä¾›è€…
- `ğŸ“„ src/components/UserAuth.tsx` - ç”¨æˆ·è®¤è¯ç»„ä»¶

### âœ… ä¾èµ–åŒ…å·²æ·»åŠ 
- `next-auth` - ç”¨æˆ·è®¤è¯
- `prisma` + `@prisma/client` - æ•°æ®åº“ORM
- `stripe` - æ”¯ä»˜å¤„ç†
- `bcryptjs` - å¯†ç åŠ å¯†

## ğŸš€ å®‰è£…å’Œé…ç½®æ­¥éª¤

### ç¬¬1æ­¥ï¼šå®‰è£…ä¾èµ–
```bash
cd ä½›å±±code
npm install
```

### ç¬¬2æ­¥ï¼šæ•°æ®åº“è®¾ç½®
```bash
# åˆå§‹åŒ–Prisma
npx prisma generate

# æ¨é€æ•°æ®åº“ç»“æ„ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
npx prisma db push

# æˆ–è€…è¿è¡Œè¿ç§»ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npx prisma migrate dev --name init
```

### ç¬¬3æ­¥ï¼šç¯å¢ƒå˜é‡é…ç½®
åˆ›å»º `.env.local` æ–‡ä»¶ï¼š
```env
# æ•°æ®åº“è¿æ¥
DATABASE_URL="postgresql://username:password@localhost:5432/asmr_db"

# NextAuthé…ç½®
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-nextauth-secret-key-here"

# Google OAuth
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# Stripeæ”¯ä»˜
STRIPE_PUBLISHABLE_KEY="pk_test_..."
STRIPE_SECRET_KEY="sk_test_..."

# VEO3 API (ç°æœ‰)
VEO3_API_KEY="your-veo3-api-key"
VEO3_API_BASE_URL="https://api.kie.ai"
```

### ç¬¬4æ­¥ï¼šGoogle OAuthè®¾ç½®

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. å¯ç”¨ Google+ API
4. åˆ›å»ºOAuth 2.0å®¢æˆ·ç«¯IDï¼š
   - åº”ç”¨ç±»å‹ï¼šWebåº”ç”¨
   - æˆæƒé‡å®šå‘URIï¼š`http://localhost:3000/api/auth/callback/google`
   - ç”Ÿäº§ç¯å¢ƒï¼š`https://yourdomain.com/api/auth/callback/google`

## ğŸ”§ é›†æˆåˆ°ç°æœ‰é¡µé¢

### æ›´æ–°ä¸»é¡µé¢ (src/app/page.tsx)
åœ¨ä¸»é¡µé¢å¤´éƒ¨æ·»åŠ ç”¨æˆ·è®¤è¯ç»„ä»¶ï¼š

```tsx
// åœ¨ç°æœ‰importsä¸­æ·»åŠ 
import UserAuth from '@/components/UserAuth'

// åœ¨é¡µé¢é¡¶éƒ¨æ·»åŠ å¯¼èˆªæ 
export default function ASMRVideoStudio() {
  // ... ç°æœ‰ä»£ç  ...
  
  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50">
      {/* æ·»åŠ é¡¶éƒ¨å¯¼èˆªæ  */}
      <nav className="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div className="flex items-center space-x-2">
            <h1 className="text-2xl font-bold text-purple-600">CuttingASMR</h1>
            <span className="text-sm text-gray-500">AIè§†é¢‘ç”Ÿæˆå™¨</span>
          </div>
          <UserAuth />
        </div>
      </nav>
      
      {/* ç°æœ‰é¡µé¢å†…å®¹ */}
      <div className="container mx-auto px-4 py-8">
        {/* ... ç°æœ‰ä»£ç  ... */}
      </div>
    </div>
  )
}
```

### æ›´æ–°è§†é¢‘ç”Ÿæˆé€»è¾‘
ä¿®æ”¹ `src/hooks/useVideoGeneration.ts` ä»¥é›†æˆç§¯åˆ†ç³»ç»Ÿï¼š

```tsx
// åœ¨generateVideoå‡½æ•°å¼€å§‹æ—¶æ·»åŠ ç§¯åˆ†æ£€æŸ¥
const generateVideo = useCallback(async (options: VideoGenerationOptions) => {
  try {
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
    const session = await getSession()
    if (!session?.user) {
      throw new Error('è¯·å…ˆç™»å½•')
    }

    // æ£€æŸ¥ç§¯åˆ†æˆ–è¯•ç”¨æ¬¡æ•°
    const creditsResponse = await fetch('/api/user/credits')
    const creditsResult = await creditsResponse.json()
    
    if (!creditsResult.success) {
      throw new Error('è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥')
    }

    const credits = creditsResult.credits
    const canUseTrial = credits.trialUsed < credits.trialLimit
    const hasCredits = (credits.totalCredits - credits.usedCredits) > 0

    if (!canUseTrial && !hasCredits) {
      throw new Error('ç§¯åˆ†ä¸è¶³ï¼Œè¯·è´­ä¹°ç§¯åˆ†æˆ–å‡çº§ä¼šå‘˜')
    }

    // ä½¿ç”¨ç§¯åˆ†æˆ–è¯•ç”¨æ¬¡æ•°
    const useCreditsResponse = await fetch('/api/user/credits', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ useTrial: canUseTrial, creditsToUse: 1 })
    })

    if (!useCreditsResponse.ok) {
      throw new Error('æ‰£é™¤ç§¯åˆ†å¤±è´¥')
    }

    // ... ç»§ç»­ç°æœ‰çš„ç”Ÿæˆé€»è¾‘
  } catch (error) {
    // ... é”™è¯¯å¤„ç†
  }
}, [])
```

## ğŸ’³ æ”¯ä»˜ç³»ç»Ÿé›†æˆ (ç¬¬2é˜¶æ®µ)

### Stripeæ”¯ä»˜ç»„ä»¶
```tsx
// src/components/CreditPurchase.tsx
const creditPackages = {
  starter: { credits: 100, price: 999, name: 'å…¥é—¨åŒ…' },
  pro: { credits: 300, price: 2499, name: 'ä¸“ä¸šåŒ…' },
  premium: { credits: 600, price: 3999, name: 'é«˜çº§åŒ…' }
}
```

### æ”¯ä»˜APIè·¯ç”±
```tsx
// src/app/api/payments/create-checkout/route.ts
// åˆ›å»ºStripe checkoutä¼šè¯
```

## ğŸ“Š æ•°æ®åº“æ¶æ„ä¼˜åŠ¿

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **æœ€å°åŒ–å­˜å‚¨** - åªå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€ç§¯åˆ†ã€æ”¯ä»˜è®°å½•
- **æœ¬åœ°ä¼˜å…ˆ** - è§†é¢‘å†å²è®°å½•ä¼˜å…ˆä½¿ç”¨localStorage
- **å¯æ‰©å±•æ€§** - æ”¯æŒæœªæ¥æ·»åŠ è®¢é˜…ã€ä¼šå‘˜ç­‰åŠŸèƒ½

### æ•°æ®è¡¨ç»“æ„
1. **users** - ç”¨æˆ·åŸºç¡€ä¿¡æ¯
2. **user_credits** - ç§¯åˆ†ç®¡ç†
3. **payments** - æ”¯ä»˜è®°å½•
4. **subscriptions** - è®¢é˜…ç®¡ç†ï¼ˆå¯é€‰ï¼‰
5. **video_history** - äº‘ç«¯å†å²è®°å½•ï¼ˆå¯é€‰ï¼‰

## ğŸ” å®‰å…¨æ€§è€ƒè™‘

### å·²å®ç°çš„å®‰å…¨ç‰¹æ€§
- âœ… å¯†ç åŠ å¯†å­˜å‚¨ (bcrypt)
- âœ… JWTä¼šè¯ç®¡ç†
- âœ… Google OAuthå®‰å…¨è®¤è¯
- âœ… APIè·¯ç”±æƒé™éªŒè¯
- âœ… ç¯å¢ƒå˜é‡ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

### æ¨èçš„é¢å¤–å®‰å…¨æªæ–½
- å®æ–½è¯·æ±‚é¢‘ç‡é™åˆ¶
- æ·»åŠ é‚®ç®±éªŒè¯
- å®æ–½åŒå› ç´ è®¤è¯ï¼ˆå¯é€‰ï¼‰

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°çš„ä¼˜åŒ–
- âœ… æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- âœ… æœ¬åœ°å­˜å‚¨å‡å°‘APIè°ƒç”¨
- âœ… JWTä¼šè¯å‡å°‘æ•°æ®åº“æŸ¥è¯¢
- âœ… æŒ‰éœ€åŠ è½½ç»„ä»¶

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### åŠŸèƒ½æµ‹è¯•æ¸…å•
- [ ] ç”¨æˆ·æ³¨å†Œæµç¨‹
- [ ] Google OAuthç™»å½•
- [ ] ç§¯åˆ†ç³»ç»Ÿè¿ä½œ
- [ ] è¯•ç”¨æ¬¡æ•°é™åˆ¶
- [ ] è§†é¢‘ç”Ÿæˆæƒé™éªŒè¯
- [ ] æ”¯ä»˜æµç¨‹ï¼ˆç¬¬2é˜¶æ®µï¼‰

### æµ‹è¯•ç”¨ä¾‹
```javascript
// ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹
describe('ç”¨æˆ·è®¤è¯ç³»ç»Ÿ', () => {
  test('ç”¨æˆ·æ³¨å†ŒæˆåŠŸåˆ›å»ºç§¯åˆ†è®°å½•', async () => {
    // æµ‹è¯•é€»è¾‘
  })
  
  test('è¯•ç”¨æ¬¡æ•°æ­£ç¡®æ‰£é™¤', async () => {
    // æµ‹è¯•é€»è¾‘  
  })
})
```

## ğŸš¢ éƒ¨ç½²é…ç½®

### æ•°æ®åº“è®¾ç½®
- **å¼€å‘ç¯å¢ƒ**: PostgreSQLæœ¬åœ°å®ä¾‹
- **ç”Ÿäº§ç¯å¢ƒ**: Railway/Supabase PostgreSQL
- **å¤‡ä»½ç­–ç•¥**: è‡ªåŠ¨æ¯æ—¥å¤‡ä»½

### ç¯å¢ƒé…ç½®
```javascript
// next.config.js æ·»åŠ 
env: {
  NEXTAUTH_URL: process.env.NEXTAUTH_URL,
  DATABASE_URL: process.env.DATABASE_URL,
}
```

## ğŸ“‹ å®æ–½æ—¶é—´è¡¨

### ç¬¬1å‘¨ï¼šåŸºç¡€è®¤è¯ç³»ç»Ÿ
- [x] æ•°æ®åº“æ¨¡å¼è®¾è®¡
- [x] NextAuthé›†æˆ
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½
- [ ] ç§¯åˆ†ç³»ç»Ÿæµ‹è¯•
- [ ] Google OAuthæ¥å…¥

### ç¬¬2å‘¨ï¼šæ”¯ä»˜ç³»ç»Ÿ
- [ ] Stripeé›†æˆ
- [ ] ç§¯åˆ†è´­ä¹°æµç¨‹
- [ ] Webhookå¤„ç†
- [ ] æ”¯ä»˜æˆåŠŸå¤„ç†

### ç¬¬3å‘¨ï¼šç³»ç»Ÿå®Œå–„
- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å®‰å…¨å®¡æ ¸

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ
1. **NextAuthä¾èµ–é”™è¯¯**: å…ˆå®‰è£…ä¾èµ– `npm install`
2. **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥DATABASE_URLé…ç½®
3. **Google OAuthå¤±è´¥**: éªŒè¯å®¢æˆ·ç«¯IDå’Œé‡å®šå‘URI
4. **Prismaç”Ÿæˆå¤±è´¥**: è¿è¡Œ `npx prisma generate`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å…³é”®é…ç½®æ£€æŸ¥æ¸…å•
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²è®¾ç½®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Google OAuthé…ç½®æ­£ç¡®
- [ ] NextAuthä¼šè¯æ­£å¸¸å·¥ä½œ
- [ ] APIè·¯ç”±å“åº”æ­£å¸¸

---

## ğŸ‰ æ€»ç»“

è¿™ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿè®¾è®¡å……åˆ†è€ƒè™‘äº†æ‚¨é¡¹ç›®çš„ç‰¹ç‚¹ï¼š

1. **å…¼å®¹ç°æœ‰æ¶æ„** - æ— ç¼é›†æˆåˆ°å½“å‰çš„ASMRè§†é¢‘ç”Ÿæˆåº”ç”¨
2. **æˆæœ¬æ•ˆç›Šä¼˜åŒ–** - æœ€å°åŒ–æ•°æ®å­˜å‚¨å’Œç»´æŠ¤æˆæœ¬
3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ** - ç®€åŒ–ç™»å½•æµç¨‹ï¼Œæ”¯æŒGoogleä¸€é”®ç™»å½•
4. **å¯æ‰©å±•è®¾è®¡** - ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•é¢„ç•™ç©ºé—´
5. **å®‰å…¨å¯é ** - é‡‡ç”¨ä¸šç•Œæ ‡å‡†çš„è®¤è¯å’Œå®‰å…¨æ–¹æ¡ˆ

æŒ‰ç…§è¿™ä¸ªæŒ‡å—ï¼Œæ‚¨å¯ä»¥åœ¨2-3å‘¨å†…å®Œæˆå®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿå®æ–½ã€‚å¦‚æœæœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜ï¼Œéšæ—¶å¯ä»¥è¿›ä¸€æ­¥å’¨è¯¢ï¼ 